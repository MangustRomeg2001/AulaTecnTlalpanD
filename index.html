<!DOCTYPE html>
<html>
<head>
  <title>Registro de Datos de Salud</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1 {
      text-align: center;
    }
    form {
      margin-bottom: 20px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    .delete-btn {
      cursor: pointer;
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Registro de Datos de Salud</h1>
  
  <form id="healthForm">
    <label for="dateTime">Fecha y Hora:</label>
    <input type="datetime-local" id="dateTime" required><br><br>
    
    <label for="meal">Ayuno o Desayuno:</label>
    <input type="radio" id="fasting" name="mealType" value="Ayuno">
    <label for="fasting">Ayuno</label>
    <input type="radio" id="breakfast" name="mealType" value="Desayuno">
    <label for="breakfast">Desayuno</label><br><br>
    
    <label for="glucose">Nivel de Glucosa:</label>
    <input type="number" id="glucose" required><br><br>
    
    <label for="bloodPressure">Presión Arterial:</label><br>
    <label for="diastolic">Diastólica:</label>
    <input type="number" id="diastolic" required>
    <label for="systolic">Sistólica:</label>
    <input type="number" id="systolic" required>
    <label for="pulse">Pulso:</label>
    <input type="number" id="pulse" required><br><br>
    
    <label for="oxygen">Nivel de Oxigenación:</label>
    <input type="number" id="oxygen" required><br><br>
    
    <button type="button" onclick="saveData()">Guardar</button>
  </form>

  <table id="data-table">
    <thead>
      <tr>
        <th>Fecha y Hora</th>
        <th>Ayuno o Desayuno</th>
        <th>Glucosa</th>
        <th>Presión Arterial (Diastólica)</th>
        <th>Presión Arterial (Sistólica)</th>
        <th>Pulso</th>
        <th>Oxigenación</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody id="data-body"></tbody>
  </table>

  <button onclick="downloadCSV()">Descargar CSV</button>

  <script>
    function saveData() {
      let dateTime = document.getElementById("dateTime").value;
      let mealType = document.querySelector('input[name="mealType"]:checked').value;
      let glucose = document.getElementById("glucose").value;
      let diastolic = document.getElementById("diastolic").value;
      let systolic = document.getElementById("systolic").value;
      let pulse = document.getElementById("pulse").value;
      let oxygen = document.getElementById("oxygen").value;

      let healthData = {
        "DateTime": dateTime,
        "MealType": mealType,
        "Glucose": glucose,
        "Diastolic": diastolic,
        "Systolic": systolic,
        "Pulse": pulse,
        "Oxygen": oxygen
      };

      let existingData = JSON.parse(localStorage.getItem("HealthRecords")) || [];
      existingData.push(healthData);
      localStorage.setItem("HealthRecords", JSON.stringify(existingData));
      
      displayData();
    }

    function displayData() {
      let tableBody = document.getElementById("data-body");
      tableBody.innerHTML = "";

      let savedData = JSON.parse(localStorage.getItem("HealthRecords")) || [];
      savedData.forEach((data, index) => {
        let row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.DateTime}</td>
          <td>${data.MealType}</td>
          <td>${data.Glucose}</td>
          <td>${data.Diastolic}</td>
          <td>${data.Systolic}</td>
          <td>${data.Pulse}</td>
          <td>${data.Oxygen}</td>
          <td><span class="delete-btn" onclick="deleteEntry(${index})">Eliminar</span></td>
        `;
        tableBody.appendChild(row);
      });
    }

    function deleteEntry(index) {
      let savedData = JSON.parse(localStorage.getItem("HealthRecords")) || [];
      savedData.splice(index, 1);
      localStorage.setItem("HealthRecords", JSON.stringify(savedData));
      displayData(); // Actualizar la tabla después de eliminar
    }

    function downloadCSV() {
      let savedData = JSON.parse(localStorage.getItem("HealthRecords")) || [];
      if (savedData.length === 0) {
        alert("No hay datos para descargar.");
        return;
      }

      let csvContent = "data:text/csv;charset=utf-8,"
        + "DateTime,MealType,Glucose,Diastolic,Systolic,Pulse,Oxygen\n";

      savedData.forEach(data => {
        let row = Object.values(data).join(",");
        csvContent += row + "\n";
      });

      let encodedURI = encodeURI(csvContent);
      let link = document.createElement("a");
      link.setAttribute("href", encodedURI);
      link.setAttribute("download", "registros_de_salud.csv");
      document.body.appendChild(link);
      link.click();
    }

    window.onload = displayData; // Mostrar datos al cargar la página
  </script>
</body>
</html>
